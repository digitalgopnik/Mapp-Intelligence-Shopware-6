{% sw_extends '@Storefront/storefront/layout/meta.html.twig' %}

{% block layout_head_meta_tags_charset %}
    {{ parent() }}
    {% block ti_loader_snippet %}
        <script type="text/javascript">
            window._tiConfig = window._tiConfig || {
                tiDomain: "{{ page.header.extensions.tiLoader.tiDomain|sw_sanitize }}",
                tiId: "{{ page.header.extensions.tiLoader.tiId|sw_sanitize }}",
                option: {}
            };
            (function(a,d,c,f){a.wts=a.wts||[];var g=function(b){var a="";b.customDomain&&b.customPath?a=b.customDomain+"/"+b.customPath:b.tiDomain&&b.tiId&&(a=b.tiDomain+"/resp/api/get/"+b.tiId+"?url="+encodeURIComponent("https://"+d.location.host+"/")+"&v=5");if(b.option)for(var c in b.option)a+="&"+c+"="+encodeURIComponent(b.option[c]);return a};if(-1===d.cookie.indexOf("wt_r=1")){var e=d.getElementsByTagName(c)[0];c=d.createElement(c);c.async=!0;c.onload=function(){if("undefined"!==typeof a.wt_r&&!isNaN(a.wt_r)){var b=
                new Date,c=b.getTime()+1E3*parseInt(a.wt_r);b.setTime(c);d.cookie="wt_r=1;path=/;expires="+b.toUTCString()}};c.onerror=function(){"undefined"!==typeof a.wt_mcp_hide&&"function"===typeof a.wt_mcp_hide.show&&(a.wt_mcp_hide.show(),a.wt_mcp_hide.show=function(){})};c.src="//"+g(f);e.parentNode.insertBefore(c,e)}})(window,document,"script",_tiConfig);
        </script>
    {% endblock %}

    {% block _ti %}
        <script>
            window._ti = {
                pageName: location.host + location.pathname,
                customerId: '{{ context.customer.uniqueIdentifier }}',
                currency: '{{ context.currency.isoCode }}'
            }

            {% if activeRoute == 'frontend.search.page' %}
                window._ti.searchTerm = '{{ page.searchTerm }}';
                window._ti.numberOfSearchResults = '{{ page.searchResult.total }}';
            {% endif %}

            {% if activeRoute == 'frontend.detail.page' %}
                window._ti.productCost = '{{ page.product.calculatedListingPrice.to.unitPrice }}';
                window._ti.productId = '{{  page.product.productNumber }}';
                window._ti.productShopwareId = '{{  page.product.id }}';
                window._ti.productName = '{{ page.product.translated.name }}';
                window._ti.productQuantity = '1';
                window._ti.shoppingCartStatus = 'view';
                window._ti.productCategories = JSON.parse('{{ getCategoryNames(page.product.categoryTree)|json_encode|raw }}');
                if(window._ti.productCategories[0]) {
                    window._ti.productCategory = window._ti.productCategories[0];
                }
                if(window._ti.productCategories[1]) {
                    window._ti.productSubCategory = window._ti.productCategories[1];
                }
            {% endif %}
        </script>

{#        {{ dump() }}#}
    {% endblock %}
{% endblock %}
